<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SuperByte Niches</title>
  <style>
    :root {
      --bg1: #050711;
      --bg2: #0b1020;
      --neon: #00f6ff;
      --neon2: #9b5cff;
      --text: #eaf1ff;
      --muted: #b7c3e6;
      --card: rgba(255, 255, 255, .06);
      --card2: rgba(255, 255, 255, .10);
      --stroke: rgba(255, 255, 255, .12);
      --shadow: 0 12px 40px rgba(0, 0, 0, .45);
      --radius: 22px;
      --wheelZ: 320px;
      /* wheel radius */
      --wheelHeight: 360px;
      /* viewport height (half wheel) */
      --wheelDrop: 120px;
      /* pushes wheel down so back half is hidden */
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1000px 700px at 20% 10%, rgba(155, 92, 255, .18), transparent 55%),
        radial-gradient(900px 600px at 80% 20%, rgba(0, 246, 255, .16), transparent 55%),
        linear-gradient(180deg, var(--bg2), var(--bg1));
      overflow-x: hidden;
    }

    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 26px 18px 46px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 14px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      user-select: none;
    }

    .brand .dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, var(--neon) 55%, rgba(0, 0, 0, 0) 72%);
      box-shadow: 0 0 18px rgba(0, 246, 255, .6);
    }

    .brand h1 {
      margin: 0;
      font-size: 18px;
      letter-spacing: .4px;
      font-weight: 700;
    }

    .brand small {
      display: block;
      margin-top: 2px;
      color: var(--muted);
      font-weight: 500;
      letter-spacing: .2px;
      font-size: 12px;
    }

    .top-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn {
      appearance: none;
      border: 1px solid var(--stroke);
      background: rgba(255, 255, 255, .04);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 650;
      letter-spacing: .2px;
      transition: transform .12s ease, background .12s ease, border-color .12s ease, box-shadow .12s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .btn:hover {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, .07);
      border-color: rgba(255, 255, 255, .22);
      box-shadow: 0 10px 26px rgba(0, 0, 0, .25);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn.neon {
      border-color: rgba(0, 246, 255, .35);
      box-shadow: 0 0 0 rgba(0, 246, 255, 0);
      position: relative;
    }

    .btn.neon:hover {
      box-shadow:
        0 0 18px rgba(0, 246, 255, .22),
        0 0 42px rgba(0, 246, 255, .12);
    }

    .btn.primary {
      background: linear-gradient(135deg, rgba(0, 246, 255, .18), rgba(155, 92, 255, .14));
      border-color: rgba(0, 246, 255, .28);
    }

    .btn.ghost {
      background: transparent;
    }

    .stage {
      margin-top: 10px;
      border: 1px solid rgba(255, 255, 255, .10);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255, 255, 255, .05), rgba(255, 255, 255, .02));
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .stage-inner {
      padding: 18px 16px 20px;
    }

    /* =========================
       WHEEL (half shown)
    ========================== */
    .wheel-row {
      display: grid;
      grid-template-columns: 1fr;
      align-items: start;
      justify-items: center;
      gap: 14px;
      padding-top: 6px;
    }

    .wheel-shell {
      width: 100%;
      max-width: 920px;
      position: relative;
    }

    .wheel-viewport {
      position: relative;
      width: 100%;
      height: var(--wheelHeight);
      overflow: hidden;
      /* hides back half */
      perspective: 1200px;
      border-radius: 20px;
      background:
        radial-gradient(800px 420px at 50% 95%, rgba(0, 246, 255, .10), transparent 60%),
        radial-gradient(700px 380px at 50% 100%, rgba(155, 92, 255, .08), transparent 60%),
        rgba(255, 255, 255, .02);
      border: 1px solid rgba(255, 255, 255, .10);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, .08);
    }

    /* fade at top to sell "into page" */
    .wheel-viewport::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: linear-gradient(to top, rgba(0, 0, 0, .65), rgba(0, 0, 0, 0) 45%);
    }

    .wheel {
      position: absolute;
      left: 50%;
      top: 50%;
      transform-style: preserve-3d;
      transform: translate(-50%, -50%) translateY(var(--wheelDrop)) rotateY(var(--rot, 0deg));
      transition: transform .45s cubic-bezier(.2, .8, .2, 1);
      width: 1px;
      height: 1px;
    }

    .wheel-item {
      position: absolute;
      width: 240px;
      height: 150px;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255, 255, 255, .10), rgba(255, 255, 255, .04));
      border: 1px solid rgba(255, 255, 255, .14);
      box-shadow: 0 18px 40px rgba(0, 0, 0, .35);
      transform-style: preserve-3d;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      overflow: hidden;
      cursor: pointer;
      user-select: none;
    }

    .wheel-item .top {
      padding: 14px 14px 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .wheel-item .logo {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, .9), rgba(0, 246, 255, .55) 55%, rgba(155, 92, 255, .35) 100%);
      box-shadow: 0 0 18px rgba(0, 246, 255, .22);
      flex: 0 0 auto;
    }

    .wheel-item h3 {
      margin: 0;
      font-size: 14px;
      letter-spacing: .25px;
      font-weight: 800;
      line-height: 1.1;
    }

    .wheel-item .tag {
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      opacity: .95;
      font-weight: 600;
    }

    .wheel-item .bottom {
      padding: 10px 14px 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .pill {
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(0, 0, 0, .18);
      color: rgba(234, 241, 255, .92);
      letter-spacing: .25px;
      font-weight: 700;
      white-space: nowrap;
    }

    .hint {
      font-size: 11px;
      color: rgba(234, 241, 255, .70);
      font-weight: 650;
      letter-spacing: .2px;
      opacity: .9;
    }

    /* active (front-facing) feel */
    .wheel-item.is-front {
      filter: brightness(1.14) saturate(1.18);
      border-color: rgba(0, 246, 255, .22);
      box-shadow:
        0 18px 50px rgba(0, 0, 0, .42),
        0 0 26px rgba(0, 246, 255, .14);
    }

    .wheel-item.is-side {
      opacity: .75;
      filter: brightness(.92) saturate(.95);
    }

    /* Arrow controls */
    .wheel-controls {
      position: absolute;
      left: 50%;
      top: 56%;
      transform: translate(-50%, -50%);
      width: 100%;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
      padding: 0 10px;
    }

    .arrow {
      pointer-events: auto;
      width: 54px;
      height: 54px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, .14);
      background: rgba(0, 0, 0, .22);
      color: var(--text);
      cursor: pointer;
      display: grid;
      place-items: center;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: .5px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease, background .12s ease;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
    }

    .arrow:hover {
      transform: translateY(-1px);
      border-color: rgba(0, 246, 255, .25);
      box-shadow:
        0 12px 34px rgba(0, 0, 0, .38),
        0 0 18px rgba(0, 246, 255, .12);
      background: rgba(0, 0, 0, .28);
    }

    .arrow:active {
      transform: translateY(0);
    }

    /* =========================
       UNDER-WHEEL INFO (no right panel)
    ========================== */
    .under {
      width: 100%;
      max-width: 920px;
      margin-top: 10px;
      padding: 14px 14px 16px;
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, .10);
      background: rgba(255, 255, 255, .03);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, .06);
    }

    .under-top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .picked {
      min-width: 220px;
    }

    .picked h2 {
      margin: 0;
      font-size: 18px;
      letter-spacing: .25px;
      font-weight: 900;
    }

    .picked p {
      margin: 8px 0 0;
      color: rgba(234, 241, 255, .78);
      font-weight: 600;
      letter-spacing: .15px;
      line-height: 1.45;
      font-size: 13px;
      max-width: 70ch;
    }

    .under-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .under-actions .btn {
      padding: 10px 16px;
      font-weight: 800;
    }

    .split {
      margin-top: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      color: rgba(234, 241, 255, .70);
      font-weight: 650;
      font-size: 12px;
      letter-spacing: .2px;
    }

    /* =========================
       MODALS
    ========================== */
    .overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, .68);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      z-index: 50;
      padding: 18px;
    }

    .overlay.open {
      display: flex;
    }

    .modal {
      width: min(980px, 96vw);
      max-height: min(88vh, 820px);
      overflow: hidden;
      border-radius: 26px;
      border: 1px solid rgba(255, 255, 255, .14);
      background: linear-gradient(180deg, rgba(255, 255, 255, .06), rgba(255, 255, 255, .03));
      box-shadow: 0 26px 80px rgba(0, 0, 0, .6);
      position: relative;
    }

    .modal-head {
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, .10);
      background: rgba(0, 0, 0, .18);
    }

    .modal-head .title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 900;
      letter-spacing: .25px;
    }

    .modal-head .title .mini {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, var(--neon) 55%, rgba(0, 0, 0, 0) 72%);
      box-shadow: 0 0 18px rgba(0, 246, 255, .6);
    }

    .x {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(255, 255, 255, .04);
      color: var(--text);
      cursor: pointer;
      font-size: 18px;
      font-weight: 900;
    }

    .x:hover {
      border-color: rgba(255, 255, 255, .22);
      background: rgba(255, 255, 255, .06);
    }

    /* Browse grid */
    .grid-wrap {
      padding: 16px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
    }

    .tile {
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(0, 0, 0, .18);
      overflow: hidden;
      cursor: pointer;
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
    }

    .tile:hover {
      transform: translateY(-1px);
      border-color: rgba(0, 246, 255, .22);
      box-shadow: 0 14px 40px rgba(0, 0, 0, .35);
    }

    .tile .ico {
      width: 44px;
      height: 44px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(0, 246, 255, .55), rgba(155, 92, 255, .45));
      box-shadow: 0 0 22px rgba(0, 246, 255, .16);
      flex: 0 0 auto;
    }

    .tile .meta {
      min-width: 0;
    }

    .tile .meta b {
      display: block;
      font-size: 13px;
      letter-spacing: .25px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tile .meta span {
      display: block;
      margin-top: 4px;
      font-size: 12px;
      color: rgba(234, 241, 255, .70);
      font-weight: 650;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Fullscreen takeover */
    .takeover {
      position: fixed;
      inset: 0;
      display: none;
      z-index: 80;
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(155, 92, 255, .22), transparent 55%),
        radial-gradient(1000px 700px at 80% 20%, rgba(0, 246, 255, .18), transparent 55%),
        linear-gradient(180deg, #080b18, #050711);
    }

    .takeover.open {
      display: block;
    }

    .takeover-top {
      position: sticky;
      top: 0;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px;
      background: rgba(0, 0, 0, .35);
      border-bottom: 1px solid rgba(255, 255, 255, .10);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }

    .banner {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }

    .banner .bigico {
      width: 54px;
      height: 54px;
      border-radius: 18px;
      background: linear-gradient(135deg, rgba(0, 246, 255, .65), rgba(155, 92, 255, .55));
      box-shadow: 0 0 28px rgba(0, 246, 255, .18);
      flex: 0 0 auto;
    }

    .banner .text {
      min-width: 0;
    }

    .banner .text h2 {
      margin: 0;
      font-size: 16px;
      font-weight: 950;
      letter-spacing: .25px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .banner .text p {
      margin: 5px 0 0;
      color: rgba(234, 241, 255, .72);
      font-weight: 650;
      letter-spacing: .2px;
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 60vw;
    }

    .takeover-main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 26px 18px 70px;
    }

    .hero {
      border-radius: 26px;
      border: 1px solid rgba(255, 255, 255, .12);
      background: linear-gradient(180deg, rgba(255, 255, 255, .06), rgba(255, 255, 255, .02));
      box-shadow: 0 24px 90px rgba(0, 0, 0, .55);
      overflow: hidden;
      position: relative;
    }

    .hero::before {
      content: "";
      position: absolute;
      inset: -2px;
      background: radial-gradient(600px 300px at 30% 10%, rgba(0, 246, 255, .22), transparent 60%),
        radial-gradient(700px 360px at 70% 20%, rgba(155, 92, 255, .20), transparent 62%);
      pointer-events: none;
      filter: blur(2px);
    }

    .hero-inner {
      position: relative;
      padding: 26px 18px 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
      text-align: center;
    }

    .neon-enter {
      margin-top: 8px;
      padding: 14px 22px;
      border-radius: 999px;
      border: 1px solid rgba(0, 246, 255, .35);
      background: rgba(0, 0, 0, .20);
      color: var(--text);
      cursor: pointer;
      font-weight: 950;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      box-shadow:
        0 0 0 rgba(0, 246, 255, 0),
        0 16px 50px rgba(0, 0, 0, .35);
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease, background .12s ease;
      position: relative;
    }

    .neon-enter:hover {
      transform: translateY(-1px);
      border-color: rgba(0, 246, 255, .55);
      background: rgba(0, 0, 0, .25);
      box-shadow:
        0 0 22px rgba(0, 246, 255, .18),
        0 0 60px rgba(0, 246, 255, .12),
        0 18px 60px rgba(0, 0, 0, .40);
    }

    .neon-enter:active {
      transform: translateY(0);
    }

    .mini-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .note {
      color: rgba(234, 241, 255, .72);
      font-weight: 650;
      font-size: 13px;
      line-height: 1.55;
      max-width: 74ch;
      margin: 0 auto;
    }

    /* Responsive */
    @media (max-width: 520px) {
      .wheel-item {
        width: 210px;
        height: 145px;
      }

      :root {
        --wheelZ: 280px;
        --wheelHeight: 340px;
        --wheelDrop: 115px;
      }

      .banner .text p {
        max-width: 50vw;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="dot"></div>
        <div>
          <h1>SuperByte Brilliance</h1>
          <small>Niches Wheel</small>
        </div>
      </div>

      <div class="top-actions">
        <button class="btn neon" id="btnBrowseTop">Browse</button>
      </div>
    </header>

    <section class="stage">
      <div class="stage-inner">
        <div class="wheel-row">
          <div class="wheel-shell">
            <div class="wheel-viewport" id="wheelViewport">
              <div class="wheel" id="wheel"></div>

              <div class="wheel-controls">
                <button class="arrow" id="btnPrev" aria-label="Previous">‹</button>
                <button class="arrow" id="btnNext" aria-label="Next">›</button>
              </div>
            </div>
          </div>

          <div class="under" id="underInfo">
            <div class="under-top">
              <div class="picked">
                <h2 id="pickedTitle">Select a niche</h2>
                <p id="pickedDesc">
                  All niches let you browse, join communities, view shared resources, and explore tools & content that
                  the niche supports.
                </p>
              </div>

              <div class="under-actions">
                <button class="btn primary neon" id="btnJoin">Join</button>
                <button class="btn" id="btnView">View</button>
                <button class="btn ghost" id="btnBrowse">Browse</button>
              </div>
            </div>

            <div class="split">
              <div id="pickedHint">Tip: use arrows or click a card.</div>
              <div id="pickedPill">Wheel</div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Browse Modal -->
  <div class="overlay" id="browseOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Browse niches">
      <div class="modal-head">
        <div class="title">
          <span class="mini"></span>
          <span>Browse Niches</span>
        </div>
        <button class="x" id="closeBrowse" aria-label="Close">✕</button>
      </div>
      <div class="grid-wrap">
        <div class="grid" id="browseGrid"></div>
      </div>
    </div>
  </div>

  <!-- Fullscreen Takeover -->
  <div class="takeover" id="takeover" aria-hidden="true">
    <div class="takeover-top">
      <div class="banner">
        <div class="bigico" id="takeoverIcon"></div>
        <div class="text">
          <h2 id="takeoverTitle">Niche</h2>
          <p id="takeoverSub">A quick launch panel for this niche.</p>
        </div>
      </div>
      <div class="mini-actions">
        <button class="btn" id="takeoverView">View</button>
        <button class="btn neon primary" id="takeoverJoin">Join</button>
        <button class="x" id="takeoverClose" aria-label="Close">✕</button>
      </div>
    </div>

    <div class="takeover-main">
      <div class="hero">
        <div class="hero-inner">
          <div class="note" id="takeoverBody">
            All niches support browsing, joining, and viewing community content. If we ever add special features that
            never change for a specific niche,
            they’ll show here.
          </div>
          <button class="neon-enter" id="takeoverNeonJoin">JOIN</button>
          <div class="note" style="margin-top:10px; opacity:.9;">
            (Control panel comes later — members will manage joined niches there.)
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ======= DATA =======
    const NICHES = [
      { id: "ai", name: "AI Builders", tag: "Agents • Automations", pill: "Popular" },
      { id: "cars", name: "Auto Diagnostics", tag: "Repair • Knowledge", pill: "Tools" },
      { id: "web", name: "Web Launch", tag: "Sites • Pages", pill: "Live" },
      { id: "branding", name: "Brand & Content", tag: "Clips • Social", pill: "Media" },
      { id: "makers", name: "Makers", tag: "Build • Tinker", pill: "Labs" },
      { id: "security", name: "Cyber Basics", tag: "Harden • Learn", pill: "Guide" },
      { id: "local", name: "Local Biz Growth", tag: "Leads • Offers", pill: "Biz" },
      { id: "gaming", name: "Game Experiments", tag: "WebGL • Fun", pill: "Play" }
    ];

    // ======= ELEMENTS =======
    const wheel = document.getElementById("wheel");
    const btnPrev = document.getElementById("btnPrev");
    const btnNext = document.getElementById("btnNext");

    const pickedTitle = document.getElementById("pickedTitle");
    const pickedDesc = document.getElementById("pickedDesc");
    const pickedPill = document.getElementById("pickedPill");

    const btnJoin = document.getElementById("btnJoin");
    const btnView = document.getElementById("btnView");
    const btnBrowse = document.getElementById("btnBrowse");
    const btnBrowseTop = document.getElementById("btnBrowseTop");

    const browseOverlay = document.getElementById("browseOverlay");
    const browseGrid = document.getElementById("browseGrid");
    const closeBrowse = document.getElementById("closeBrowse");

    const takeover = document.getElementById("takeover");
    const takeoverTitle = document.getElementById("takeoverTitle");
    const takeoverSub = document.getElementById("takeoverSub");
    const takeoverBody = document.getElementById("takeoverBody");
    const takeoverClose = document.getElementById("takeoverClose");
    const takeoverJoin = document.getElementById("takeoverJoin");
    const takeoverView = document.getElementById("takeoverView");
    const takeoverNeonJoin = document.getElementById("takeoverNeonJoin");

    // ======= WHEEL BUILD =======
    let index = 0;
    const total = NICHES.length;

    function buildWheel() {
      wheel.innerHTML = "";
      const angleStep = 360 / total;

      NICHES.forEach((niche, i) => {
        const item = document.createElement("div");
        item.className = "wheel-item";
        item.dataset.index = String(i);
        item.dataset.id = niche.id;

        // position in ring
        const angle = i * angleStep;
        item.style.transform = `rotateY(${angle}deg) translateZ(var(--wheelZ))`;

        item.innerHTML = `
          <div class="top">
            <div class="logo"></div>
            <div style="min-width:0">
              <h3 title="${escapeHtml(niche.name)}">${escapeHtml(niche.name)}</h3>
              <div class="tag">${escapeHtml(niche.tag)}</div>
            </div>
          </div>
          <div class="bottom">
            <span class="pill">${escapeHtml(niche.pill)}</span>
            <span class="hint">Click</span>
          </div>
        `;

        item.addEventListener("click", () => {
          index = i;
          updateWheel();
          openTakeover(niche);
        });

        wheel.appendChild(item);
      });

      updateWheel(true);
    }

    function updateWheel(noAnimate = false) {
      // rotate so selected item is at front (0deg)
      const angleStep = 360 / total;
      const rot = -index * angleStep;
      wheel.style.transition = noAnimate ? "none" : "transform .45s cubic-bezier(.2,.8,.2,1)";
      wheel.style.setProperty("--rot", `${rot}deg`);

      // mark front-ish card for emphasis
      const items = [...wheel.querySelectorAll(".wheel-item")];
      items.forEach((el, i) => {
        el.classList.remove("is-front", "is-side");
        const d = distanceCircular(i, index, total);
        if (d === 0) el.classList.add("is-front");
        else el.classList.add("is-side");
      });

      const niche = NICHES[index];
      setPicked(niche);
    }

    function distanceCircular(a, b, mod) {
      const d = Math.abs(a - b);
      return Math.min(d, mod - d);
    }

    // ======= UNDER INFO =======
    function setPicked(niche) {
      pickedTitle.textContent = niche.name;
      pickedPill.textContent = niche.pill;

      pickedDesc.textContent =
        "All niches let you browse, join communities, view shared resources, and explore tools & content that the niche supports.";

      btnJoin.onclick = () => openTakeover(niche, "join");
      btnView.onclick = () => openTakeover(niche, "view");
    }

    // ======= CONTROLS =======
    btnPrev.addEventListener("click", () => {
      index = (index - 1 + total) % total;
      updateWheel();
    });

    btnNext.addEventListener("click", () => {
      index = (index + 1) % total;
      updateWheel();
    });

    // keyboard
    window.addEventListener("keydown", (e) => {
      if (takeover.classList.contains("open")) {
        if (e.key === "Escape") closeTakeover();
        return;
      }
      if (browseOverlay.classList.contains("open")) {
        if (e.key === "Escape") closeBrowseModal();
        return;
      }
      if (e.key === "ArrowLeft") btnPrev.click();
      if (e.key === "ArrowRight") btnNext.click();
    });

    // ======= BROWSE =======
    function openBrowse() {
      browseOverlay.classList.add("open");
      browseOverlay.setAttribute("aria-hidden", "false");
    }
    function closeBrowseModal() {
      browseOverlay.classList.remove("open");
      browseOverlay.setAttribute("aria-hidden", "true");
    }

    btnBrowse.addEventListener("click", openBrowse);
    btnBrowseTop.addEventListener("click", openBrowse);
    closeBrowse.addEventListener("click", closeBrowseModal);

    browseOverlay.addEventListener("click", (e) => {
      if (e.target === browseOverlay) closeBrowseModal();
    });

    function buildBrowseGrid() {
      browseGrid.innerHTML = "";
      NICHES.forEach((niche, i) => {
        const t = document.createElement("div");
        t.className = "tile";
        t.innerHTML = `
          <div class="ico"></div>
          <div class="meta">
            <b title="${escapeHtml(niche.name)}">${escapeHtml(niche.name)}</b>
            <span>${escapeHtml(niche.tag)}</span>
          </div>
        `;
        t.addEventListener("click", () => {
          closeBrowseModal();
          index = i;
          updateWheel();
          openTakeover(niche);
        });
        browseGrid.appendChild(t);
      });
    }

    // ======= TAKEOVER =======
    function openTakeover(niche, action) {
      takeover.classList.add("open");
      takeover.setAttribute("aria-hidden", "false");

      takeoverTitle.textContent = niche.name;
      takeoverSub.textContent = niche.tag;

      takeoverBody.textContent =
        "All niches support browsing, joining, and viewing community content. If we ever add special features that never change for a specific niche, they’ll show here.";

      takeoverJoin.onclick = () => {
        // placeholder for future join action
        pulseButton(takeoverJoin);
        pulseButton(takeoverNeonJoin);
      };
      takeoverNeonJoin.onclick = takeoverJoin.onclick;

      takeoverView.onclick = () => {
        // placeholder for future view action
        pulseButton(takeoverView);
      };

      if (action === "view") pulseButton(takeoverView);
      if (action === "join") pulseButton(takeoverNeonJoin);
    }

    function closeTakeover() {
      takeover.classList.remove("open");
      takeover.setAttribute("aria-hidden", "true");
    }

    takeoverClose.addEventListener("click", closeTakeover);

    // Clicking outside hero does nothing (takeover is fullscreen)
    // but escape key closes it (see key handler)

    function pulseButton(btn) {
      btn.animate(
        [
          { transform: "translateY(0)", filter: "brightness(1)" },
          { transform: "translateY(-1px)", filter: "brightness(1.2)" },
          { transform: "translateY(0)", filter: "brightness(1)" }
        ],
        { duration: 260, easing: "cubic-bezier(.2,.8,.2,1)" }
      );
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // ======= INIT =======
    buildWheel();
    buildBrowseGrid();
  </script>
</body>

</html>